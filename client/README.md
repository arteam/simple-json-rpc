## JSON-RPC 2.0 client

Simple JSON-RPC client is a convenient way to access JSON-RPC 2.0 server.

It exposes two types of API:

* Fluent-style type-safe builder API for generating requests and handling responses
* Object style API for representing a remote service as a Java interface 

### Client

The basic class in API is `JsonRpcClient`. 

It's a factory for creating request builders: you pass to it an implementation of `Transport`.
Transport actually sends a request through the network and converts a response to a text implementation. 

Other optional argument is Jackson `ObjectMapper` that could be used for customization
of JSON serializing and data binding.

After that `JsonRpcClient` is ready for creating builders and proxies with configured transport and serialization.

#### Configuration

````java
JsonRpcClient client = new JsonRpcClient(new Transport() {

    CloseableHttpClient httpClient = HttpClients.createDefault();

    @NotNull
    @Override
    public String pass(@NotNull String request) throws IOException {
        // Used Apache HttpClient 4.3.1 as an example
        HttpPost post = new HttpPost("http://json-rpc-server/team");
        post.setEntity(new StringEntity(request, Charsets.UTF_8));
        post.setHeader(HttpHeaders.CONTENT_TYPE, MediaType.JSON_UTF_8.toString());
        try (CloseableHttpResponse httpResponse = httpClient.execute(post)) {
            return EntityUtils.toString(httpResponse.getEntity(), Charsets.UTF_8);
        }
    }
});
````

### Builder API 

The idea of this API is to provide a simple way to build a JSON-RPC request and handle a response without any JSON code. 

Builder is a great pattern for this task.

Builders are created by `createRequest` method of a `JsonRpcClient`. 
They are focused on processing actual requests data and require minimal boilerplate code. 
Builders are immutable and type-safe, so the actual request is built only in the execution phase.

#### Basic JSON-RPC request

````java
Player player = client.createRequest()
        .method("findByInitials")
        .id(43121)
        .param("firstName", "Steven")
        .param("lastName", "Stamkos")
        .returnAs(Player.class)
        .execute();
````
See more examples for using API [here] (https://github.com/arteam/simple-json-rpc/blob/master/client/src/test/java/com/github/arteam/simplejsonrpc/client/JsonRpcClientTest.java)

#### Notification JSON-RPC request
````
client.createNotification()
      .method("update")
      .param("cacheName", "profiles")
      .execute();
````

More examples for using API [here] (https://github.com/arteam/simple-json-rpc/blob/master/client/src/test/java/com/github/arteam/simplejsonrpc/client/JsonRpcClientNotifications.java)

#### Batch JSON-RPC request
````
Map<String, Player> result = client.createBatchRequest()
     .add("43121", "findByInitials", "Steven", "Stamkos")
     .add("43122", "findByInitials", "Jack", "Allen")
     .keysType(String.class)
     .returnType(Player.class)
     .execute();
````

More examples for using API [here] (https://github.com/arteam/simple-json-rpc/blob/master/client/src/test/java/com/github/arteam/simplejsonrpc/client/BatchRequestBuilderTest.java)

## Object style API

The idea of this API is defining an interface that models a remote service.

The library generates a proxy on this interface that transform method calls to JSON-RPC requests and 
JSON-RPC responses to return values.

The proxy is generated by calling method `onDemand` of `JsonRpcClient`. 

You business code then can safely works with an interface as though it's usual Java class without any JSON-RPC awareness.  
 
For this task you need to annotate your interface with `@JsonRpcService`, `@JsonRpcMethod` 
and `@JsonRpcParam` annotations.

* `@JsonRpcService` marks an interface as a JSON-RPC service.
* `@JsonRpcMethod` marks a method as a JSON-RPC method.
* `@JsonRpcParam` is a mandatory annotation for the method parameter and it should contain a parameter name 
(this is forced requirement because Java compiler doesn't retain information about parameter names in a class file 
and therefore this information is not available in runtime).

Additional annotations:

* `@JsonRpcId` is used for defining a generator of request identifiers. `CurrentTimeIdGenerator` is used by default.
* `@JsonRpcParams` is used for defining type of JSON-RPC request params (array or map). 
It could be applied on an interface and on a method as well.
* `@JsonRpcOptional` is used for marking method parameter as an optional. Parameter marked with this annotation
can accept null values. By default all parameters are mandatory.

### Example

**Service Interface**

````java
@JsonRpcService
@JsonRpcId(TestIdGenerator.class)
@JsonRpcParams(ParamsType.MAP)
public interface TeamService {

    @JsonRpcMethod
    boolean add(@JsonRpcParam("player") Player s);

    @JsonRpcMethod("find_by_birth_year")
    List<Player> findByBirthYear(@JsonRpcParam("birth_year") int birthYear);

    @JsonRpcMethod
    @JsonRpcParams(ParamsType.ARRAY)
    Player findByInitials(@JsonRpcParam("firstName") String firstName,
                          @JsonRpcParam("lastName") String lastName);

    @JsonRpcMethod("findByInitials")
    Optional<Player> optionalFindByInitials(@JsonRpcParam("firstName") String firstName,
                                            @JsonRpcParam("lastName") String lastName);

    @JsonRpcMethod
    List<Player> find(@JsonRpcOptional @JsonRpcParam("position") @Nullable Position position,
                      @JsonRpcOptional @JsonRpcParam("number") int number,
                      @JsonRpcOptional @JsonRpcParam("team") @NotNull Optional<Team> team,
                      @JsonRpcOptional @JsonRpcParam("firstName") @Nullable String firstName,
                      @JsonRpcOptional @JsonRpcParam("lastName") @Nullable String lastName,
                      @JsonRpcOptional @JsonRpcParam("birthDate") @Nullable Date birthDate,
                      @JsonRpcOptional @JsonRpcParam("capHit") @NotNull Optional<Double> capHit);

    @JsonRpcMethod
    List<Player> findPlayersByFirstNames(@JsonRpcParam("names") List<String> names);
}
````

**Basic request**
````java
 Player player = client.onDemand(TeamService.class).findByInitials("Steven", "Stamkos");
````

More examples for using API [here] (https://github.com/arteam/simple-json-rpc/blob/master/client/src/test/java/com/github/arteam/simplejsonrpc/client/JsonRpcObjectAPITest.java)

## Setup
Maven:
```xml
<dependency>
   <groupId>com.github.arteam</groupId>
   <artifactId>simple-json-rpc-client</artifactId>
   <version>0.4</version>
</dependency>
```
Artifacts are available in [jCenter](https://bintray.com/bintray/jcenter) repository.

## Requirements

JDK 1.6 and higher

## Dependencies

* [Jackson](https://github.com/FasterXML/jackson) 2.4.1
* [IntelliJ IDEA Annotations](http://mvnrepository.com/artifact/com.intellij/annotations/12.0) 12.0
